<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <title>Quản lý chuyên ngành</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>

<body>
  <div class="container mt-4">
    <h2 class="mb-4">Quản lý chuyên ngành</h2>
    <a th:href="@{/admin/boMon}" class="btn btn-secondary mb-3">← Quay lại Quản lý bộ môn</a>
    <div class="card mb-4">
      <div class="card-body">
        <form th:action="@{/admin/boMon/chuyen-nganh/save}" th:object="${chuyenNganhForm}" method="post">
          <input type="hidden" th:field="*{id}" />
          <div class="row mb-3">
            <div class="col">
              <label for="maChuyenNganh" class="form-label">Mã chuyên ngành</label>
              <input type="text" id="maChuyenNganh" class="form-control" th:field="*{maChuyenNganh}" required />
              <div class="text-danger" th:if="${#fields.hasErrors('maChuyenNganh')}" th:errors="*{maChuyenNganh}"></div>
            </div>
            <div class="col">
              <label for="tenChuyenNganh" class="form-label">Tên chuyên ngành</label>
              <input type="text" id="tenChuyenNganh" class="form-control" th:field="*{tenChuyenNganh}" required />
              <div class="text-danger" th:if="${#fields.hasErrors('tenChuyenNganh')}" th:errors="*{tenChuyenNganh}">
              </div>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col">
              <label for="boMonSelect" class="form-label">Bộ môn</label>
              <select id="boMonSelect" class="form-control" th:field="*{idBoMon.id}" required>
                <option value="">--Chọn bộ môn--</option>
                <option th:each="bm : ${boMons}" th:value="${bm.id}" th:text="${bm.tenBoMon}"></option>
              </select>
              <div class="text-danger" th:if="${#fields.hasErrors('idBoMon.id')}" th:errors="*{idBoMon.id}"></div>
            </div>
            <div class="col">
              <label for="trangThaiChuyenNganh" class="form-label">Trạng thái</label>
              <select id="trangThaiChuyenNganh" class="form-control" th:field="*{trangThai}">
                <option th:value="true">Hoạt động</option>
                <option th:value="false">Ngừng hoạt động</option>
              </select>
            </div>
          </div>
          <button type="submit" class="btn btn-primary">Lưu</button>
          <button type="button" class="btn btn-secondary" onclick="window.location.href='/admin/boMon/chuyen-nganh'">Làm
            mới</button>
        </form>
      </div>
    </div>
    <div class="card">
      <div class="card-body">
        <h5>Danh sách chuyên ngành</h5>
        <table class="table table-bordered mt-3">
          <thead>
            <tr>
              <th>STT</th>
              <th>Mã chuyên ngành</th>
              <th>Tên chuyên ngành</th>
              <th>Bộ môn</th>
              <th>Trạng thái</th>
              <th>Thao tác</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="cn, stat : ${chuyenNganhs}">
              <td th:text="${stat.index + 1}"></td>
              <td th:text="${cn.maChuyenNganh}"></td>
              <td th:text="${cn.tenChuyenNganh}"></td>
              <td th:if="${cn.idBoMon != null}" th:text="${cn.idBoMon.tenBoMon}"></td>
              <td th:unless="${cn.idBoMon != null}"></td>
              <td>
                <span th:if="${cn.trangThai == true}">Hoạt động</span>
                <span th:if="${cn.trangThai == false}">Ngừng hoạt động</span>
              </td>
              <td>
                <a th:href="@{/admin/boMon/chuyen-nganh(editChuyenNganhId=${cn.id},page=${currentPage})}"
                  class="btn btn-primary btn-sm me-1" title="Sửa"><i class="fas fa-eye"></i></a>
                <a th:href="@{/admin/boMon/chuyen-nganh/toggleTrangThai/{id}(id=${cn.id})}"
                  class="btn btn-warning btn-sm" title="Chuyển trạng thái"
                  onclick="return confirm('Bạn có chắc chắn muốn chuyển trạng thái chuyên ngành này?');">
                  <i class="fas fa-exchange-alt"></i>
                </a>
              </td>
            </tr>
            <tr th:if="${chuyenNganhs == null or #lists.isEmpty(chuyenNganhs)}">
              <td colspan="6" class="text-center">Không có chuyên ngành</td>
            </tr>
          </tbody>
        </table>
        <div class="d-flex justify-content-center align-items-center mt-3 gap-2">
          <button class="btn btn-outline-secondary btn-sm">
            <a th:href="@{/admin/boMon/chuyen-nganh(page=0)}"
              th:classappend="${currentPage == 0} ? ' disabled' : ''">Trang đầu</a>
          </button>
          <button class="btn btn-outline-secondary btn-sm">
            <a th:href="@{/admin/boMon/chuyen-nganh(page=${currentPage > 0 ? currentPage - 1 : 0})}"
              th:classappend="${currentPage == 0} ? ' disabled' : ''">Trang trước</a>
          </button>
          <span>Trang <span th:text="${currentPage + 1}"></span> / <span th:text="${totalPages}"></span></span>
          <button class="btn btn-outline-secondary btn-sm">
            <a th:href="@{/admin/boMon/chuyen-nganh(page=${currentPage < totalPages - 1 ? currentPage + 1 : totalPages - 1})}"
              th:classappend="${currentPage == totalPages - 1} ? ' disabled' : ''">Trang sau</a>
          </button>
          <button class="btn btn-outline-secondary btn-sm">
            <a th:href="@{/admin/boMon/chuyen-nganh(page=${totalPages - 1})}"
              th:classappend="${currentPage == totalPages - 1} ? ' disabled' : ''">Trang cuối</a>
          </button>
        </div>
      </div>
    </div>
  </div>
  <!-- FontAwesome for icons -->
  <script src="https://kit.fontawesome.com/4e8e4e4e4e.js" crossorigin="anonymous"></script>
  <!-- Thông báo SweetAlert2 toast -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script th:inline="javascript">
    /*<![CDATA[*/
    const message = /*[[${message}]]*/ null;
    const error = /*[[${errorMessage}]]*/ null;

    const Toast = Swal.mixin({
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: 3000,
      timerProgressBar: true,
    });

    if (message !== null && message !== 'null' && message !== '') {
      Toast.fire({
        icon: 'success',
        title: message
      });
    }

    if (error !== null && error !== 'null' && error !== '') {
      Toast.fire({
        icon: 'error',
        title: error
      });
    }
    /*]]>*/
  </script>
</body>

</html> 