<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Danh S√°ch Giai ƒêo·∫°n</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    /* --- ƒê·ªãnh nghƒ©a bi·∫øn CSS cho m√†u s·∫Øc v√† b√≥ng ƒë·ªï --- */
    :root {
      --primary-color: #4A90E2; /* Xanh d∆∞∆°ng ch·ªß ƒë·∫°o */
      --primary-light: #EBF5FF; /* Xanh d∆∞∆°ng nh·∫°t */
      --primary-lighter: #F0F8FF; /* Xanh d∆∞∆°ng r·∫•t nh·∫°t cho header card */
      --secondary-color: #6C757D; /* X√°m trung t√≠nh */
      --background-light: #F8F9FA; /* N·ªÅn tr·∫Øng ng√† */
      --text-dark: #212529; /* M√†u ch·ªØ ƒë·∫≠m */
      --text-medium: #495057; /* M√†u ch·ªØ trung b√¨nh */
      --text-light: #6C757D; /* M√†u ch·ªØ nh·∫°t */
      --border-color: #DEE2E6; /* M√†u vi·ªÅn */
      --shadow-light: rgba(0, 0, 0, 0.05); /* B√≥ng ƒë·ªï nh·∫π */
      --shadow-medium: rgba(0, 0, 0, 0.1); /* B√≥ng ƒë·ªï trung b√¨nh */
      --success-color: #28A745; /* M√†u xanh l√° c√¢y cho th√†nh c√¥ng */
      --warning-color: #FFC107; /* M√†u v√†ng cho c·∫£nh b√°o */
      --danger-color: #DC3545; /* M√†u ƒë·ªè cho nguy hi·ªÉm */
      --info-color: #17A2B8; /* M√†u xanh lam cho th√¥ng tin */
      --gray-light: #E9ECEF; /* X√°m nh·∫π cho thanh ti·∫øn ƒë·ªô n·ªÅn */
    }

    /* --- Global Styles --- */
    body {
      font-family: 'Inter', sans-serif; /* S·ª≠ d·ª•ng font Inter cho m·ªôt c√°i nh√¨n hi·ªán ƒë·∫°i */
      background-color: var(--background-light);
      margin: 0;
      padding: 20px;
      color: var(--text-dark);
      line-height: 1.6; /* TƒÉng kho·∫£ng c√°ch d√≤ng ƒë·ªÉ d·ªÖ ƒë·ªçc h∆°n */
    }

    .container {
      max-width: 960px; /* Chi·ªÅu r·ªông t·ªëi ƒëa cho container ch√≠nh */
      margin: auto;
      background-color: #ffffff;
      border-radius: 12px; /* Bo g√≥c m·ªÅm m·∫°i cho container */
      box-shadow: 0 4px 12px var(--shadow-medium); /* B√≥ng ƒë·ªï s√¢u h∆°n t·∫°o chi·ªÅu s√¢u */
      padding: 30px; /* Padding l·ªõn h∆°n */
    }

    /* --- Filter Section --- */
    .filter-section {
      padding: 25px;
      background-color: #FFFFFF; /* ƒê√£ thay ƒë·ªïi th√†nh m√†u tr·∫Øng */
      border-radius: 10px; /* Bo g√≥c */
      margin-bottom: 30px;
      border: 1px solid #D1E9FF; /* Vi·ªÅn xanh nh·∫π */
      box-shadow: 0 2px 8px var(--shadow-light); /* Th√™m b√≥ng ƒë·ªï nh·∫π cho ph·∫ßn n√†y */
    }

    .filter-header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      color: var(--primary-color);
      font-weight: 600;
      font-size: 1.1em; /* K√≠ch th∆∞·ªõc ti√™u ƒë·ªÅ */
    }

    .filter-header i {
      margin-right: 10px;
      font-size: 1.3em; /* K√≠ch th∆∞·ªõc icon l·ªõn h∆°n */
    }

    .filter-inputs {
      display: flex;
      gap: 20px; /* Kho·∫£ng c√°ch gi·ªØa c√°c input */
    }

    .filter-inputs input {
      flex: 1; /* Chia ƒë·ªÅu kh√¥ng gian */
      padding: 12px 18px; /* Padding input l·ªõn h∆°n */
      border: 1px solid var(--border-color);
      border-radius: 8px; /* Bo g√≥c input */
      font-size: 15px;
      color: var(--text-medium);
      transition: all 0.3s ease; /* Hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªông m∆∞·ª£t m√† */
      box-shadow: inset 0 1px 3px var(--shadow-light); /* B√≥ng ƒë·ªï nh·∫π b√™n trong ƒë·ªÉ t·∫°o chi·ªÅu s√¢u */
    }

    .filter-inputs input::placeholder {
      color: var(--text-light); /* M√†u placeholder nh·∫°t h∆°n */
    }

    .filter-inputs input:focus {
      outline: none; /* B·ªè vi·ªÅn outline m·∫∑c ƒë·ªãnh */
      border-color: var(--primary-color);
      box-shadow: 0 0 0 4px rgba(74, 144, 226, 0.2); /* V√≤ng s√°ng khi focus */
      background-color: #ffffff;
    }

    .date-input-container {
      position: relative;
      flex: 1;
    }

    .date-input-container input {
      padding-right: 40px; /* T·∫°o kh√¥ng gian cho icon */
    }

    .date-input-container::after {
      content: "\f4c6"; /* Unicode c·ªßa icon calendar t·ª´ Bootstrap Icons */
      font-family: "bootstrap-icons"; /* ƒê·∫£m b·∫£o s·ª≠ d·ª•ng font icon */
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-light);
      pointer-events: none; /* ƒê·∫£m b·∫£o icon kh√¥ng ch·∫∑n click */
      font-size: 1.1em;
    }

    /* --- Main Content Header (C√°c giai ƒëo·∫°n) --- */
    .main-content-header {
      display: flex;
      align-items: center;
      margin-bottom: 25px;
      color: var(--primary-color);
      font-weight: 600;
      font-size: 1.1em;
    }

    .main-content-header i {
      margin-right: 10px;
      font-size: 1.3em;
    }

    /* --- Stage Card --- */
    .stage-card {
      background-color: #ffffff;
      border: 1px solid #E0E0E0;
      border-radius: 10px; /* Bo g√≥c nh·∫π h∆°n container ch√≠nh */
      margin-bottom: 20px;
      overflow: hidden; /* ƒê·∫£m b·∫£o n·ªôi dung kh√¥ng tr√†n ra ngo√†i bo g√≥c */
      box-shadow: 0 2px 8px var(--shadow-light); /* B√≥ng ƒë·ªï nh·∫π */
      transition: all 0.2s ease-in-out; /* Hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªông khi hover */
    }

    .stage-card:hover {
      border-color: var(--primary-color); /* Vi·ªÅn m√†u xanh khi hover */
      box-shadow: 0 6px 16px var(--shadow-medium); /* B√≥ng ƒë·ªï r√µ h∆°n */
      transform: translateY(-3px); /* Nh·∫•c nh·∫π card l√™n */
    }

    .stage-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 18px 25px;
      background-color: var(--primary-lighter); /* N·ªÅn xanh r·∫•t nh·∫°t cho header */
      border-bottom: 1px solid #D5E7F7; /* Vi·ªÅn ƒë·∫≠m h∆°n */
      cursor: pointer;
      position: relative;
      user-select: none; /* NgƒÉn ng∆∞·ªùi d√πng ch·ªçn vƒÉn b·∫£n khi click ƒë·ªÉ toggle */
    }

    .stage-header-left {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-grow: 1;
    }

    .stage-header-left .toggle-icon {
      font-size: 1.3em;
      color: var(--text-light);
      transition: transform 0.2s; /* Hi·ªáu ·ª©ng xoay m≈©i t√™n */
    }
    .stage-header.expanded .toggle-icon {
      transform: rotate(90deg); /* Xoay m≈©i t√™n khi m·ªü r·ªông */
    }

    .stage-title {
      font-size: 17px;
      font-weight: 600;
      color: var(--text-dark);
    }

    .stage-meta {
      font-size: 13px;
      color: var(--text-medium);
      margin-left: 15px;
    }

    .stage-header-right button {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 9px 18px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* B√≥ng ƒë·ªï nh·∫π cho n√∫t */
    }

    .stage-header-right button:hover {
      background-color: #3A7CCF; /* M√†u xanh ƒë·∫≠m h∆°n khi hover */
      box-shadow: 0 4px 8px rgba(0,0,0,0.15); /* B√≥ng ƒë·ªï r√µ h∆°n */
    }

    .stage-content {
      display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
      padding: 20px 25px;
      background-color: #FDFDFD; /* N·ªÅn tr·∫Øng g·∫ßn nh∆∞ tinh khi·∫øt cho n·ªôi dung */
    }
    .stage-header.expanded + .stage-content {
      display: block; /* Hi·ªán khi header c√≥ class 'expanded' */
    }

    /* --- Task Item inside Stage Content --- */
    .task-item-in-stage {
      background-color: #ffffff;
      border: 1px solid #E6E6E6;
      border-radius: 8px;
      padding: 15px 20px;
      margin-bottom: 12px;
      display: flex;
      flex-direction: column;
      position: relative;
      box-shadow: 0 1px 4px var(--shadow-light);
      transition: all 0.2s ease-in-out;
      cursor: pointer; /* Bi·ªÉu th·ªã r·∫±ng c√≥ th·ªÉ click ƒë·ªÉ m·ªü chi ti·∫øt */
    }
    .task-item-in-stage:last-child {
      margin-bottom: 0; /* B·ªè margin d∆∞·ªõi cho ph·∫ßn t·ª≠ cu·ªëi c√πng */
    }
    .task-item-in-stage:hover {
      border-color: #A2D2FF; /* M√†u vi·ªÅn khi hover */
      box-shadow: 0 3px 10px rgba(0,0,0,0.08); /* B√≥ng ƒë·ªï r√µ h∆°n */
      transform: translateY(-2px); /* Nh·∫•c nh·∫π task l√™n */
    }

    .task-title {
      font-size: 16px;
      font-weight: 500;
      color: var(--text-dark);
      margin-bottom: 10px;
    }

    .task-meta-in-stage {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: var(--text-medium);
      margin-bottom: 10px;
    }

    .task-progress-bar-container {
      background: var(--gray-light); /* M√†u n·ªÅn thanh ti·∫øn ƒë·ªô */
      border-radius: 4px;
      height: 7px;
      width: 100%;
      overflow: hidden;
    }

    .task-progress-bar-fill {
      background: var(--primary-color);
      height: 100%;
      width: 0%; /* S·∫Ω ƒë∆∞·ª£c set b·∫±ng JS ho·∫∑c d·ªØ li·ªáu ƒë·ªông */
      border-radius: 4px;
      transition: width 0.5s ease-out; /* Hi·ªáu ·ª©ng ƒë·ªông cho thanh ti·∫øn ƒë·ªô */
    }

    .task-progress-percentage {
      font-size: 12px;
      color: var(--text-light);
      margin-top: 8px;
      text-align: right; /* CƒÉn ph·∫£i ph·∫ßn trƒÉm */
      font-weight: 500;
    }

    .task-priority-tag {
      position: absolute;
      top: 15px;
      right: 18px;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.08); /* B√≥ng ƒë·ªï nh·∫π cho tag */
    }

    /* Colors for priority tags (th√™m m√†u cho "G·∫•p" n·∫øu c·∫ßn) */
    .priority-cao {
      background-color: #E6FFED; /* Xanh l√° nh·∫°t */
      color: var(--success-color); /* Xanh l√° ƒë·∫≠m */
    }
    .priority-trung-binh {
      background-color: #FFF3CD; /* V√†ng nh·∫°t */
      color: #FFA500; /* Cam ƒë·∫≠m */
    }
    .priority-thap {
      background-color: #E0F2F7; /* Xanh lam nh·∫°t */
      color: var(--info-color); /* Xanh lam ƒë·∫≠m */
    }
    .priority-gap { /* Th√™m m√†u cho ƒë·ªô ∆∞u ti√™n "G·∫•p" n·∫øu c√≥ */
      background-color: #F8D7DA; /* ƒê·ªè nh·∫°t */
      color: var(--danger-color); /* ƒê·ªè ƒë·∫≠m */
    }

    /* --- Responsive adjustments --- */
    @media (max-width: 768px) {
      body {
        padding: 10px; /* Gi·∫£m padding t·ªïng th·ªÉ tr√™n mobile */
      }
      .container {
        padding: 15px;
        border-radius: 8px; /* Bo g√≥c √≠t h∆°n tr√™n mobile */
        box-shadow: 0 2px 8px var(--shadow-medium);
      }
      .filter-inputs {
        flex-direction: column; /* X·∫øp input theo chi·ªÅu d·ªçc tr√™n mobile */
        gap: 15px;
      }
      .filter-section, .stage-card {
        padding: 15px; /* Gi·∫£m padding */
      }
      .stage-header {
        flex-direction: column; /* X·∫øp header theo chi·ªÅu d·ªçc */
        align-items: flex-start;
        gap: 10px;
        padding: 15px 20px;
      }
      .stage-header-right {
        width: 100%;
        text-align: center;
      }
      .stage-header-right button {
        width: 100%; /* N√∫t chi·∫øm to√†n b·ªô chi·ªÅu r·ªông */
      }
      .stage-title {
        font-size: 16px;
      }
      .stage-meta {
        margin-left: 0; /* X√≥a margin-left ƒë·ªÉ cƒÉn tr√°i */
        font-size: 12px;
      }
      .stage-content {
        padding: 15px 20px;
      }
      .task-item-in-stage {
        padding: 12px 15px;
      }
      .task-priority-tag {
        position: static; /* ƒê·∫∑t l·∫°i v·ªã tr√≠ */
        margin-top: 8px;
        margin-left: auto; /* ƒê·∫©y tag sang ph·∫£i trong flex column */
      }
      .task-title {
        margin-bottom: 5px;
      }
      .task-meta-in-stage {
        flex-direction: column; /* X·∫øp meta info theo chi·ªÅu d·ªçc */
        align-items: flex-start;
        margin-bottom: 5px;
      }
    }
    /*.stage-content {*/
    /*  display: none;*/
    /*}*/

    /* Form chi ti·∫øt c√¥ng vi·ªác - modal ch√≠nh */
    .formCongViecChiTiet {
      display: flex;
      width: 820px;
      gap: 20px;
      padding: 20px;
      background: #f4f5f7;
      font-family: sans-serif;

      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }

    .main-content, .sidebar {
      background: #fff; padding: 20px; border-radius: 3px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);cursor: not-allowed;
    }
    .main-content { flex-grow: 1; cursor: not-allowed;}
    .sidebar { width: 250px; cursor: not-allowed;}
    h3 { margin-top: 0; color: #5e6c84; display: flex; align-items: center; gap: 8px; cursor: not-allowed;}
    button { border: 1px dashed #ccc; background: #f4f5f7; padding: 5px 10px; border-radius: 3px; margin-right: 5px; cursor: not-allowed;}
    .priority-group { display: flex; align-items: center; gap: 5px; cursor: not-allowed;}
    .priority-group .current-priority { background: #dfe1e6; padding: 5px 10px; border-radius: 3px; cursor: not-allowed;}
    textarea { width: 100%; min-height: 60px; border: 1px solid #ccc; border-radius: 3px; padding: 8px; box-sizing: border-box; cursor: not-allowed;}
    .progress-bar-container { background: #dfe1e6; border-radius: 3px; height: 8px; margin-bottom: 10px; overflow: hidden; cursor: not-allowed;}
    .progress-bar { background: #0079bf; height: 100%; width: 0; cursor: not-allowed;}
    .add-button { background: #0079bf; color: #fff; border: none; padding: 8px 15px; border-radius: 3px; cursor: not-allowed;}
    .add-button:hover { background: #0052cc; cursor: not-allowed;}
    .sidebar-item { display: flex; align-items: center; padding: 8px 12px; margin-bottom: 8px; background: #f4f5f7; border-radius: 3px; cursor: not-allowed;}
    .sidebar-item:hover { background: #e1e4e8; cursor: not-allowed;}
    .comment-box { display: flex; gap: 10px; align-items: flex-start; cursor: not-allowed;}
    .avatar { width: 32px; height: 32px; background: #ccc; border-radius: 50%; cursor: not-allowed;}
    .comment-input { flex-grow: 1; position: relative; cursor: not-allowed;}
    .send-icon { position: absolute; right: 10px; bottom: 10px; color: #5e6c84; cursor: not-allowed;}
    .toggle-details { color: #5e6c84;  font-size: 0.9em; cursor: not-allowed;}
    .sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; color: #5e6c84; cursor: not-allowed;}
    .doUuTien{cursor: not-allowed;pointer-events: none;}
    .close-btn { cursor: pointer; font-size: 1.2em; }

  </style>
</head>
<body>

<div class="container">
  <div class="filter-section">
    <div class="filter-header">
      <i class="bi bi-funnel"></i> B·ªô l·ªçc
    </div>
    <div class="filter-inputs">
      <input type="text" id="tenGiaiDoanInput" placeholder="Nh·∫≠p t√™n giai ƒëo·∫°n">
      <div class="date-input-container">
        <input type="date" id="ngayBatDauInput">
      </div>
    </div>
  </div>

  <div class="main-content-header">
    <i class="bi bi-collection"></i> C√°c giai ƒëo·∫°n
  </div>

  <div id="stage-list" th:fragment="stageList">
    <div class="stage-card" th:each="gd : ${dsGiaiDoanThanhVien}">
      <div class="stage-header" id="stageHeader1">
        <div class="stage-header-left">
          <i class="bi bi-chevron-right toggle-icon"></i>
          <span class="stage-title" th:text="${gd.tenGiaiDoan}">Giai ƒëo·∫°n 1</span>
          <span class="stage-meta" th:text="${gd.ngayBatDau} + ' - ' + ${gd.ngayKetThuc}">>22/05/2025 - 29/05/2025</span>
          <span class="stage-meta">(10 c√¥ng vi·ªác)</span>
        </div>
        <div class="stage-header-right">
          <button>Chi ti·∫øt</button>
        </div>
      </div>
      <div class="stage-content" id="stageContent1">
        <div th:if="${dsCongViecTheoDuAnThanhVien[gd.id] != null}">
          <div class="task-item-in-stage"
               th:each="cv : ${dsCongViecTheoDuAnThanhVien[gd.id]}">
              <span class="task-priority-tag" th:classappend="${'priority-' + cv.doUuTien.toLowerCase().replace(' ', '-')}" th:text="${cv.doUuTien}">Cao</span>

              <div class="task-actions"> <a th:href="@{/detailThanhVien/{id}(id=${cv.id}, idDuAn=${idDuAn})}" style="text-decoration: none; color: inherit;">
                <i class="bi bi-pencil-square"></i>
              </a>
              </div>
              <span class="task-title" th:text="${cv.tenCongViec}">Thi·∫øt k·∫ø s∆° ƒë·ªì ph√¢n r√£ c√°c ch·ª©c nƒÉng</span>

              <div class="task-meta-in-stage">
                <span th:text="${cv.ngayHetHan}">H·∫°n: 25/05/2025</span>
              </div>

              <div class="task-progress-bar-container">
                <div class="task-progress-bar-fill" style="width: 0%;"></div>
              </div>
              <span class="task-progress-percentage">Ti·∫øn ƒë·ªô: 0%</span>
            </div>
        </div>
      </div>
    </div>
  </div>
  <div th:if="${congViecChiTiet != null}">
  <div id="formChiTiet"
       data-task-id="[[${congViecChiTiet.id}]]"
       class="formCongViecChiTiet"
       th:style="${openModal} ? 'display:flex;' : 'display:none;'">
    <div class="main-content" th:object="${congViecChiTiet}">
      <h1 th:text="*{tenCongViec}">Code giao di·ªán</h1>

      <div style="display:flex; gap:20px; align-items:center; margin-bottom:20px;">
        <div>üîñ
          <button><span class="icon" th:text="*{nhanDan}"></span></button>
          <button><span class="icon">+</span> Th√†nh vi√™n</button>
        </div>
        <div class="priority-group">
          <span>ƒê·ªô ∆∞u ti√™n:</span>
          <form th:action="@{/update-cong-viec-do-uu-tien}" method="post">
            <input type="hidden" name="idDuAn" th:value="${idDuAn}" />
            <input type="hidden" name="id" th:value="${congViecChiTiet.id}" />
            <select class="doUuTien" name="doUuTien" onchange="this.form.submit()">
              <option value="Quan tr·ªçng" th:selected="${congViecChiTiet.doUuTien == 'Quan tr·ªçng'}">üí° Quan tr·ªçng</option>
              <option value="Cao" th:selected="${congViecChiTiet.doUuTien == 'Cao'}">üî• Cao</option>
              <option value="Trung b√¨nh" th:selected="${congViecChiTiet.doUuTien == 'Trung b√¨nh'}">üõ°Ô∏è Trung b√¨nh</option>
              <option value="Th·∫•p" th:selected="${congViecChiTiet.doUuTien == 'Th·∫•p'}">‚¨áÔ∏è Th·∫•p</option>
            </select>
          </form>

        </div>

      </div>
      <div>Ki·ªÉu c√¥ng vi·ªác: <span th:text="${congViecChiTiet.kieuCv}"></span></div>
      <div class="form-section">
        <form th:action="@{/update-mo-ta}" method="post">
          <input type="hidden" name="idDuAn" th:value="${idDuAn}" />
          <input type="hidden" name="id" th:value="${congViecChiTiet.id}" />

          <h3><span class="icon">üìÑ</span> M√¥ t·∫£</h3>
          <textarea id="moTaTextarea"
                    placeholder="Th√™m m√¥ t·∫£..."
                    onfocus="hienNutLuu()"
                    name="moTa"
                    th:text="${congViecChiTiet.moTa}"></textarea>

          <button id="nutLuuMoTa" class="add-button" type="submit" style="display: none;">
            L∆∞u
          </button>
        </form>
      </div>


      <div class="form-section">
        <h3><span class="icon">‚òëÔ∏è</span> Nh·ªØng vi·ªác c·∫ßn l√†m</h3>
        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
          <span>0%</span>
          <div class="progress-bar-container" style="flex-grow:1;">
            <div class="progress-bar"></div>
          </div>
        </div>
        <button class="add-button">+ Th√™m</button>
      </div>
      <div class="form-section">
        <div style="text-align: center;">
          <img th:src="@{'/uploads/' + ${congViecChiTiet.taiAnh}}" alt="·∫¢nh s·∫£n ph·∫©m" width="300px" style="padding: 10px;"/>
        </div>
      </div>

      <div class="form-section">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h3><span class="icon">üí¨</span> B√¨nh lu·∫≠n</h3>
          <span class="toggle-details">Hi·ªÉn th·ªã Chi ti·∫øt</span>
        </div>
        <div class="comment-box">
          <div class="avatar"></div>
          <div class="comment-input">
            <textarea placeholder="Vi·∫øt b√¨nh lu·∫≠n... nh·∫≠p @ ƒë·ªÉ nh·∫Øc t·ªõi ai ƒë√≥"></textarea>
            <span class="send-icon">‚û¢</span>
          </div>
        </div>
      </div>

      <div class="form-section">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <h3><span class="icon">‚è±Ô∏è</span> Ho·∫°t ƒë·ªông</h3>
          <span class="toggle-details">Xem ƒë·∫ßy ƒë·ªß</span>
        </div>
      </div>
    </div>

    <div class="sidebar">
      <div class="sidebar-header">
        <h4>Th√™m v√†o th·∫ª</h4>
        <span class="close-btn" onclick="anFormChiTiet()">
                        √ó
                    </span>
      </div>
      <ul>
        <li class="sidebar-item"><span class="icon">üë§</span> Th√†nh vi√™n</li>
        <li class="sidebar-item" id="kieuCVButton"><span class="icon">üè∑Ô∏è</span> Ki·ªÉu c√¥ng vi·ªác</li>
        <li class="sidebar-item" id="nhanButton"><span class="icon">üîñ</span> Nh√£n</li>
        <li class="sidebar-item" id="ngayHanButton"><span class="icon">üìÖ</span> Ng√†y h·∫°n</li>
        <li class="sidebar-item" id="anhButton"><span class="icon">‚§í` </span>  T·∫£i ·∫£nh l√™n</li>
        <li class="sidebar-item" id="linkButton"><span class="icon">üîó</span> Link ƒë√≠nh k√®m</li>
      </ul>
    </div>
  </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script th:inline="javascript">
  const idDuAn = [[${idDuAn}]];
</script>
<script>
  function ganSuKienToggle() {
    const headers = document.querySelectorAll('.stage-header');
    headers.forEach(header => {
      header.addEventListener('click', function () {
        const content = this.nextElementSibling;
        const icon = this.querySelector('.toggle-icon');

        const isVisible = content.style.display === 'block';
        content.style.display = isVisible ? 'none' : 'block';

        icon.classList.toggle('bi-chevron-right', isVisible);
        icon.classList.toggle('bi-chevron-down', !isVisible);
      });
    });
  }

  function searchGiaiDoan() {
    const ten = document.getElementById("tenGiaiDoanInput").value;
    const ngay = document.getElementById("ngayBatDauInput").value;

    const params = new URLSearchParams();
    params.append("idDuAn", idDuAn);
    if (ten) params.append("tenGiaiDoan", ten);
    if (ngay) params.append("ngayBatDau", ngay);

    fetch(`/search-giai-doan?${params.toString()}`)
            .then(res => res.text())
            .then(html => {
              document.getElementById("stage-list").innerHTML = html;
              ganSuKienToggle(); // üîÅ G√°n l·∫°i toggle sau khi load fragment m·ªõi
            });
  }

  document.addEventListener('DOMContentLoaded', function () {
    ganSuKienToggle(); // ‚úÖ G√°n ban ƒë·∫ßu

    document.getElementById("tenGiaiDoanInput").addEventListener("input", searchGiaiDoan);
    document.getElementById("ngayBatDauInput").addEventListener("change", searchGiaiDoan);
  });

  function anFormChiTiet() {
    const form = document.getElementById('formChiTiet');
    if (form) {
      form.style.display = 'none';
    }
  }
</script>
</body>
</html>